

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh-CN" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh-CN" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>第二章 MongoDB基础知识 &mdash; my_book_doc  文档</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="索引" href="../../../genindex.html" />
    <link rel="search" title="搜索" href="../../../search.html" />
    <link rel="next" title="第三章 创建、更新和删除文档" href="ch3.html" />
    <link rel="prev" title="第一章 MongoDB简介" href="ch1.html" /> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> my_book_doc
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../python_book.html">python相关书籍</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../security_book.html">安全相关书籍</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../asm_c_cjj_book.html">ASM/C/C++书籍</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../algorithm.html">算法相关书籍</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../database.html">数据库相关书籍</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../high_performance_mysql.html">高性能的MySQL</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../mongodb_definitive_guide.html">MongoDB权威指南(第二版)</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="ch1.html">第一章 MongoDB简介</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">第二章 MongoDB基础知识</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">2.1 文档</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id2">2.2 集合</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id5">2.3 数据库</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id6">2.4 启动MongoDB</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mongodb-shell">2.5 MongoDB shell简介</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id9">2.6 数据类型</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id14">2.7 使用MongoDB shell</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="ch3.html">第三章 创建、更新和删除文档</a></li>
<li class="toctree-l3"><a class="reference internal" href="ch4.html">第四章 查询</a></li>
<li class="toctree-l3"><a class="reference internal" href="ch5.html">第五章 索引</a></li>
<li class="toctree-l3"><a class="reference internal" href="ch6.html">第六章 特殊的索引和集合</a></li>
<li class="toctree-l3"><a class="reference internal" href="ch7.html">第七章 聚合</a></li>
<li class="toctree-l3"><a class="reference internal" href="ch8.html">第八章 应用程序设计</a></li>
<li class="toctree-l3"><a class="reference internal" href="ch9.html">第九章 复制副本集</a></li>
<li class="toctree-l3"><a class="reference internal" href="ch10.html">第十章 副本集的组成</a></li>
<li class="toctree-l3"><a class="reference internal" href="ch11.html">第十一章 从应用程序连接副本集</a></li>
<li class="toctree-l3"><a class="reference internal" href="ch12.html">第十二章   管理</a></li>
<li class="toctree-l3"><a class="reference internal" href="ch13.html">第十三章 分片</a></li>
<li class="toctree-l3"><a class="reference internal" href="ch14.html">第十四章 配置分片</a></li>
<li class="toctree-l3"><a class="reference internal" href="ch15.html">第十五章 选择片键</a></li>
<li class="toctree-l3"><a class="reference internal" href="ch16.html">第十六章 分片管理</a></li>
<li class="toctree-l3"><a class="reference internal" href="ch17.html">第十七章 了解应用的动态</a></li>
<li class="toctree-l3"><a class="reference internal" href="ch18.html">第十八章 数据管理</a></li>
<li class="toctree-l3"><a class="reference internal" href="ch19.html">第十九章 持久性</a></li>
<li class="toctree-l3"><a class="reference internal" href="ch20.html">第二十章 启动和停止MongoDB</a></li>
<li class="toctree-l3"><a class="reference internal" href="ch21.html">第二十一章 监控MongoDB</a></li>
<li class="toctree-l3"><a class="reference internal" href="ch22.html">第二十二章 备份</a></li>
<li class="toctree-l3"><a class="reference internal" href="ch23.html">第二十三章 部署MongoDB</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ai.html">人工智能相关书籍</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../mathematics.html">数学书</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../note/othor.html">笔记</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">my_book_doc</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../database.html">数据库相关书籍</a> &raquo;</li>
        
          <li><a href="../mongodb_definitive_guide.html">MongoDB权威指南(第二版)</a> &raquo;</li>
        
      <li>第二章 MongoDB基础知识</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="mongodb">
<h1>第二章 MongoDB基础知识<a class="headerlink" href="#mongodb" title="永久链接至标题">¶</a></h1>
<p>MongoDB非常强大但很容易上手。</p>
<blockquote>
<div><ul class="simple">
<li>文档是MongoDB中数据的基本单元。非常类似于关系型数据库管理系统中的行，但更具表现力。</li>
<li>类似的，集合可以看作是一个拥有动态模型的表。</li>
<li>MongoDB的一个实例可以拥有多个相互独立的数据库，每一个数据库都拥有自己的集合。</li>
<li>MongoDB到了一个简单单功能强大的JavaScript shell 可用于管理 MongoDB 的实例或数据操作。</li>
</ul>
</div></blockquote>
<div class="section" id="id1">
<h2>2.1 文档<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h2>
<p>文档是MongoDB的核心概念。文档就是键值对的一个有序集。</p>
<p>文档的键是字符串，除了少数例外情况，键可以使用任意utf-8字符</p>
<blockquote>
<div><ul class="simple">
<li>键不能包含“\0”空字符。这个字符用于表示键的结尾。（一个斜杠+0）</li>
<li>.和$具有特殊意义，只能在特定环境中使用。通常，这两个字符是被保留的，如果使用不当，驱动程序会有提示。</li>
</ul>
</div></blockquote>
<p>MongoDB不但区分类型，还区分大小写，例如，下面两个文档是不同的:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;foo&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">}</span>
<span class="p">{</span><span class="s1">&#39;foo&#39;</span><span class="p">:</span><span class="s2">&quot;3&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>下面两个文档也是不同的:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;foo&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">}</span>
<span class="p">{</span><span class="s1">&#39;Foo&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">}</span>
</pre></div>
</div>
<p>还有一个非常重要的事项需要注意，MongoDB的文档不能有重复的键。例如，下面的文档是非法的:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;greeting&#39;</span><span class="p">:</span><span class="s1">&#39;hello world&#39;</span><span class="p">,</span><span class="s1">&#39;greeting&#39;</span><span class="p">:</span><span class="s1">&#39;hello MongoDB&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>文档中的键值对是有序的:
<strong>{‘x’:1,’y’:2}</strong>
与
<strong>{‘y’:2,’x’:1}</strong>
是不同的，通常字段顺序并不重要，无须让数据库默认依赖特定的字段顺序。在某些情况下，字段顺序变得非常重要。</p>
</div>
<div class="section" id="id2">
<h2>2.2 集合<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h2>
<p>集合就是一组文档。如果将MongoDB中的一个文档比喻成关系型数据库中的一行，那么集合就相当于一张表。</p>
<div class="section" id="id3">
<h3>2.2.1 动态模型<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h3>
<p>集合是动态模式的，这意味着一个集合里面的文档可以是各式各样的。例如下面两个文档可以存储在一个集合里面:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;greeting&#39;</span><span class="p">:</span><span class="s1">&#39;hello world&#39;</span><span class="p">}</span>
<span class="p">{</span><span class="s1">&#39;foo&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">}</span>
</pre></div>
</div>
<p>需要注意的是，上面的文档不光值类型不同(一个是字符串，一个是整数)，他们的键也不同。因为集合里面可以放置任何文档，随之而来的一个问题是：还有必要使用多个集合吗？
这的确值得思考:既然没有必要区分不同类型的文档的模式，为什么还需要多个集合呢？</p>
<blockquote>
<div><ul class="simple">
<li>如果把各种各样的文档不加区分第放在同一个集合中，无论对开发者还是对管理者来说都是噩梦。开发者要么确保每次查询只返回特性类型的文档，要么让执行查询的应用程序来处理所有不同类型的文档。</li>
<li>在一个集合里查询特定类型的文档在速度上也很不划算，分开查询多个集合要快得多。</li>
<li>把同种类型的文档放在一个集合中，数据会更加集中。</li>
<li>创建索引时，需要使用文档的附加结构。索引是按照集合来定义的。</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="id4">
<h3>2.2.2 命名<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h3>
<p>集合使用名称进行命名，集合名可以满足下列条件任何utf-8字符串</p>
<blockquote>
<div><ul class="simple">
<li>集合名不能是空字符串”“</li>
<li>集合不能包含”\0”字符(空字符)，这个字符表示集合名的结束。</li>
<li>集合名不能以”system.”开头，这是为系统保留的前缀。</li>
<li>用户创建的集合不能再集合中包含保留关键字符”$”，因为某些系统中生成的集合中包含”$”,很多驱动程序确实支持在集合中包含该字符。除非你要访问这种系统创建的集合，否则不应该在该集合中包含$。</li>
</ul>
</div></blockquote>
<p><strong>子集合</strong></p>
<p>组织集合的惯例是使用”.”分隔不同命名空间的子集合。例如一个具有博客功能的应用可能包含两个集合。分别是
<strong>blog.posts</strong>
和
<strong>blog.authors</strong>
。这是为了使组织结构更清晰。</p>
<p>在MongoDB中，使用子集合来组织数据非常高效，值得推荐。</p>
</div>
</div>
<div class="section" id="id5">
<h2>2.3 数据库<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h2>
<p>在MongoDB中，多个文档组成集合，多个集合组成数据库，一个MongoDB实例可以承载多个数据库，每个数据库用友0个或多个集合。每个数据库都有独立的权限，即使是在磁盘上，不同的数据库也放置再通的文件中。</p>
<p>数据库通过名称标识，这点与集合类似。数据库名可以是满足一下条件的任意utf-8字符串:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>- 不能是空字符串
- 不得包含有/、\\、.、&quot;、&lt;、&gt;、.....   基本上只能使用ASCII中的字母和数字。
- 数据库区分大小写，即便是在不区分大小写的文件系统中也是如此。简单起见，数据库名应该全部小写。
- 数据库名最多为64字节。
</pre></div>
</div>
<p>要记住一点。数据库最终会变成文件系统里的文件，而数据库名就是相对应的文件名。</p>
<p>另外，有一些数据库名是保留的。可以直接访问这些有特殊语义的数据库。</p>
<blockquote>
<div><ul class="simple">
<li>admin</li>
<li>local</li>
<li>config</li>
</ul>
</div></blockquote>
<p>把数据库名添加到集合前面，得到结合的完全限定名，即命名空间。例如使用cms数据库中的blog.posts集合。这个集合的命名空间就是cms.blog.posts。命名空间的长度不得超过121字节。且在实际红应小于100字节。</p>
</div>
<div class="section" id="id6">
<h2>2.4 启动MongoDB<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h2>
<p>通常，MongoDB作为网络服务器来运行，客户端可以连接该服务器进行操作。下载MongoDB并解压，运行mongod命令来启动数据库服务器:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mongod
</pre></div>
</div>
<p>mongod在没有参数的情况下会使用默认数据目录/data/db.如果数据目录不存在或者不可读写，服务器会启动失败。</p>
<p>启动时，服务器会打印版本和系统信息，然后等待连接.默认情况下，MongoDB会监听27017端口。</p>
<p>mongod还会启动一个非常基本的http服务器，监听数字比主端口高1000的端口，也就是28017端口，可以访问127.0.0.1:28017端口获取数据库管理信息。</p>
</div>
<div class="section" id="mongodb-shell">
<h2>2.5 MongoDB shell简介<a class="headerlink" href="#mongodb-shell" title="永久链接至标题">¶</a></h2>
<p>MongoDB 自带JavaScript shell 可以在shell 中使用命令与MongoDB实例交互。
shell非常有用，通过他可以执行管理操作。检查运行实例，亦或做其他操作。</p>
<p>2.5.1 运行shell</p>
<p>运行mongo启动shell:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mongo
</pre></div>
</div>
<p>启动时，shell 将自动连接MongoDB服务器，须确保mongod已启动。</p>
<p>shell 是一个功能完备的JavaScript解释器，可运行任意JavaScript程序。</p>
<div class="section" id="id7">
<h3>2.5.2 MongoDB客户端<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h3>
<p>如果想查看db当前指向那个库可以使用db命令:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">db</span>
</pre></div>
</div>
<p>选择数据库:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">use</span> <span class="n">foobar</span>
<span class="o">&gt;</span><span class="n">db</span>
<span class="n">foobar</span>
</pre></div>
</div>
</div>
<div class="section" id="id8">
<h3>2.5.3基本操作<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h3>
<p>1.创建</p>
<blockquote>
<div><p>insert函数可将一个文档添加到集合中。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">post</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span><span class="s1">&#39;blog title&#39;</span><span class="p">}</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">blog</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">post</span><span class="p">)</span>
</pre></div>
</div>
<p>查看:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">blog</span><span class="o">.</span><span class="n">find</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
<p>2.读取</p>
<blockquote>
<div><p>读取一个记录:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">blog</span><span class="o">.</span><span class="n">findOne</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
<p>3.更新</p>
<blockquote>
<div><p>使用update修改博客文章，update至少接受两个参数，第一个是限定条件，第二个是新的文档。</p>
<p>首先修改变量post，增加comment键:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">post</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
</div>
<p>然后执行update操作:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">blog</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;title&#39;</span><span class="p">:</span><span class="s1">&#39;update title&#39;</span><span class="p">},</span><span class="n">post</span><span class="p">)</span>

<span class="n">db</span><span class="o">.</span><span class="n">blog</span><span class="o">.</span><span class="n">find</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
<p>4.删除</p>
<blockquote>
<div><p>使用remove方法可将数据中永久删除，如果没有任何参数，它会将集合内所有文档删除。它可以接受一个作为限定条件的文旦作为参数</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">blog</span><span class="o">.</span><span class="n">remove</span><span class="p">({</span><span class="s1">&#39;title&#39;</span><span class="p">:</span><span class="s1">&#39;update title&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="id9">
<h2>2.6 数据类型<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h2>
<div class="section" id="id10">
<h3>2.6.1 基本数据类型<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h3>
<p>在概念上， MongoDB的文档与JavaScript中的对象相似，因而可认为它类似于json。</p>
<dl class="docutils">
<dt>MongoDB在保留json基本键值特性的基础上，添加了一些其他数据类型：</dt>
<dd><ul class="first last simple">
<li>null 用于表示空值或不存在的字段。 {‘x’：null}</li>
<li>布尔值， true 、false {‘x’:true}</li>
<li>数值 {‘x’:3.14}、{‘x’:NumberInt(“3”)}、{‘x’:NumberLong(‘3’)}</li>
<li>字符串 {‘x’:’foobar’}</li>
<li>日期 {‘x’:new Date()}</li>
<li>正则表达式 {‘x’:/foobar/i}</li>
<li>数组 {‘x’:[‘a’,’b’,3]}</li>
<li>内嵌文档   {‘x’:{1,2,3}}</li>
<li>对象id {‘x’:ObjectId()}</li>
<li>二进制数据 ！二进制不能直接在shell中使用</li>
<li>代码 查询和文档中可以包含任意JavaScript代码</li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="id11">
<h3>2.6.2 日期<a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h3>
<p>创建日期对象时，应使用new Date(),而非Date()。</p>
</div>
<div class="section" id="id12">
<h3>2.6.3 数组<a class="headerlink" href="#id12" title="永久链接至标题">¶</a></h3>
<p>数组是一组值，它既能做有序对象，也能做无序对象:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;titings&#39;</span><span class="p">:[</span><span class="s1">&#39;pie&#39;</span><span class="p">,</span><span class="mi">123</span><span class="p">]}</span>
</pre></div>
</div>
</div>
<div class="section" id="id13">
<h3>2.6.4 内嵌文档<a class="headerlink" href="#id13" title="永久链接至标题">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;job&#39;</span><span class="p">,</span><span class="s1">&#39;address&#39;</span><span class="p">:{</span><span class="s1">&#39;city&#39;</span><span class="p">:</span><span class="s1">&#39;nanning&#39;</span><span class="p">,</span><span class="s1">&#39;state&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">}}</span>
</pre></div>
</div>
</div>
<div class="section" id="idobjectid">
<h3>2.6.5 _id和ObjectId()<a class="headerlink" href="#idobjectid" title="永久链接至标题">¶</a></h3>
<p>MongoDB文档必须有一个_id键，这个键可以是任意类型，默认是ObjectId对象，在一个集合里面，每个文档都有唯一的”_id”,确保集合里面每个文档都能唯一标识。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>id生成方式：
0 1 2 3     4 5 6     7 8    9 10 11
时间戳       机器       PID    计数器
</pre></div>
</div>
<p>如果插入文档没有id键，系统会自动创建一个。</p>
</div>
</div>
<div class="section" id="id14">
<h2>2.7 使用MongoDB shell<a class="headerlink" href="#id14" title="永久链接至标题">¶</a></h2>
<p>shell 可以连接到任意MongoDB实例。在启动shell时指定机器名和端口，就可以连接到一套不同的机器:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mongo some-host:30000/myDB
</pre></div>
</div>
<p>通过–nodb参数启动shell，启动时将不会连接任何数据库:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$  mongo --nodb
</pre></div>
</div>
<p>启动之后，在需要时运行new Mongo(hostname)命令就可以连接到想要的mongo了:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conn</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Mongo</span><span class="p">(</span><span class="s1">&#39;some-host:30000&#39;</span><span class="p">)</span>
<span class="o">&gt;</span><span class="n">connection</span> <span class="n">to</span> <span class="n">some</span><span class="o">-</span><span class="n">host</span><span class="p">:</span><span class="mi">30000</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">getDB</span><span class="p">(</span><span class="s1">&#39;myDB&#39;</span><span class="p">)</span>
<span class="o">&gt;</span><span class="n">dbDB</span>
</pre></div>
</div>
<div class="section" id="shell">
<h3>2.7.1 shell 小贴士<a class="headerlink" href="#shell" title="永久链接至标题">¶</a></h3>
<p>可以使用help查看帮助:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">help</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="id15">
<h3>2.7.2 使用shell执行脚本<a class="headerlink" href="#id15" title="永久链接至标题">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mongo script.js
</pre></div>
</div>
<p>如果希望使用指定的主机/端口上的mongo运行脚本，需要先指定地址，再跟上脚本文件:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mongo --quiet server-1:30000/foo script.js
</pre></div>
</div>
</div>
<div class="section" id="mongorc-js">
<h3>2.7.3 创建.mongorc.js文件<a class="headerlink" href="#mongorc-js" title="永久链接至标题">¶</a></h3>
<p>如果某些脚本会被频繁加载，可以将它们添加到mongorc.js文件中，这个文件会在启动shell时自动运行。</p>
<p>例如，我们希望启动成功时让shell显示一句欢迎语，为此，我们在用户主目录下创建一个名为.mongorc.js的文件:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span><span class="n">mongorc</span><span class="o">.</span><span class="n">js</span>

<span class="n">var</span> <span class="n">comliment</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;attractive&#39;</span><span class="p">,</span><span class="s1">&#39;hello&#39;</span><span class="p">,</span><span class="s1">&#39;world&#39;</span><span class="p">]</span>
<span class="n">var</span> <span class="n">index</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">Math</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="mi">3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;hello world&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>为了实用，可以使用这个脚本创建一些自己需要的全局变量，或者是为一个太长的名称创建一个简短的别名，也可以重写内置函数。.mongorc.js最常见的用途之一是移除那些危险的shell辅助函数。可以在这里集中重写这些方法:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">var</span> <span class="n">no</span> <span class="o">=</span> <span class="n">function</span><span class="p">(){</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;not on my watch&#39;</span><span class="p">);</span>
<span class="p">}</span>
<span class="o">//</span><span class="n">禁止删除数据库</span>
<span class="n">db</span><span class="o">.</span><span class="n">dropDatabase</span> <span class="o">=</span> <span class="n">DB</span><span class="o">.</span><span class="n">prototype</span><span class="o">.</span><span class="n">dropDatabase</span> <span class="o">=</span> <span class="n">no</span><span class="p">;</span>
<span class="o">//</span><span class="n">禁止删除集合</span>
<span class="n">DBCollection</span><span class="o">.</span><span class="n">prototype</span><span class="o">.</span><span class="n">drop</span> <span class="o">=</span> <span class="n">no</span><span class="p">;</span>
<span class="o">//</span><span class="n">禁止删除索引</span>
<span class="n">DBCollection</span><span class="o">.</span><span class="n">prototype</span><span class="o">.</span><span class="n">dropIndex</span> <span class="o">=</span> <span class="n">no</span><span class="p">;</span>
</pre></div>
</div>
<p>如果在启动shell时指定–norc参数，就可以禁止加载.mongorc.js。</p>
</div>
<div class="section" id="id16">
<h3>2.7.4 定制shell 提示<a class="headerlink" href="#id16" title="永久链接至标题">¶</a></h3>
<p>略</p>
</div>
<div class="section" id="id17">
<h3>2.7.5 编辑复合变量<a class="headerlink" href="#id17" title="永久链接至标题">¶</a></h3>
<p>略</p>
</div>
<div class="section" id="id18">
<h3>2.7.6 集合命名注意事项<a class="headerlink" href="#id18" title="永久链接至标题">¶</a></h3>
<p>略</p>
<p><strong>广告区——博主提供付费服务，欢迎各位大佬来撩 ，提供IT咨询回答服务。快没饭吃了，大佬土豪 施舍点吧。联系方式：微信QQ电话均为18977771077.</strong></p>
<dl class="docutils">
<dt>赞助扫码::</dt>
<dd><a class="first reference internal image-reference" href="../../../_images/apay.jpg"><img alt="../../../_images/apay.jpg" src="../../../_images/apay.jpg" style="width: 198px; height: 216px;" /></a>
<a class="last reference internal image-reference" href="../../../_images/pay_wechat.png"><img alt="../../../_images/pay_wechat.png" src="../../../_images/pay_wechat.png" style="width: 226px; height: 212px;" /></a>
</dd>
</dl>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ch3.html" class="btn btn-neutral float-right" title="第三章 创建、更新和删除文档" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="ch1.html" class="btn btn-neutral" title="第一章 MongoDB简介" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, anaf.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'',
            LANGUAGE:'zh_CN',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../../_static/translations.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="../../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>