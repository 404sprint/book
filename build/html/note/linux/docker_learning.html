

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh-CN" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh-CN" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>docker学习 &mdash; my_book_doc  文档</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜索" href="../../search.html" />
    <link rel="next" title="mac使用小技巧" href="../mac/mac_use_note.html" />
    <link rel="prev" title="centos6下安装和使用git" href="centos6_install_git.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> my_book_doc
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../book/python_book.html">python相关书籍</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../book/security_book.html">安全相关书籍</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../book/asm_c_cpp_book.html">ASM/C/C++书籍</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../book/algorithm.html">算法相关书籍</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../book/database.html">数据库相关书籍</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../book/ai.html">人工智能相关书籍</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../book/mathematics.html">数学书</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../othor.html">笔记</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../use_skills.html">使用技巧</a></li>
<li class="toctree-l2"><a class="reference internal" href="../othor/crazy_programmer.html">疯狂的程序员摘要</a></li>
<li class="toctree-l2"><a class="reference internal" href="../othor/motivational_statements.html">励志话语</a></li>
<li class="toctree-l2"><a class="reference internal" href="../othor/web_site_techniques.html">网站的使用技巧一</a></li>
<li class="toctree-l2"><a class="reference internal" href="../othor/restructuredtext.html">1&nbsp;&nbsp;&nbsp;reStructuredText标记规范(转)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../othor.html#python">Python相关</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../othor.html#linux">Linux相关</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="search_nginx.html">linux查找软件(nginx)安装位置及配置信息等</a></li>
<li class="toctree-l3"><a class="reference internal" href="update_python.html">centos6下升级pyhton3</a></li>
<li class="toctree-l3"><a class="reference internal" href="centos6_install_mysql5_6.html">centos6下安装mysql5.6(转)</a></li>
<li class="toctree-l3"><a class="reference internal" href="update_mysql6_pwd.html">修改mysql密码</a></li>
<li class="toctree-l3"><a class="reference internal" href="centos6_install_git.html">centos6下安装和使用git</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">docker学习</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">基本使用</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id5">Docker 客户端</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id14">Docker 镜像使用</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id24">Docker 容器连接</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../othor.html#mac">Mac 相关</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">my_book_doc</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../othor.html">笔记</a> &raquo;</li>
        
      <li>docker学习</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="docker">
<h1>docker学习<a class="headerlink" href="#docker" title="永久链接至标题">¶</a></h1>
<div class="section" id="id1">
<h2>基本使用<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h2>
<p>使用:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#运行ubuntu:15.10 会先下载  打印一句话</span>
<span class="n">docker</span> <span class="n">run</span> <span class="n">ubuntu</span><span class="p">:</span><span class="mf">15.10</span> <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">echo</span> <span class="s2">&quot;Hello world&quot;</span>

<span class="c1">#运行centos 会先下载 打印一句话</span>
<span class="n">docker</span> <span class="n">run</span> <span class="n">centos</span> <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">echo</span> <span class="s2">&quot;Hello world&quot;</span>
</pre></div>
</div>
<div class="section" id="id2">
<h3>运行交互式的容器<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h3>
<p>我们通过docker的两个参数 -i -t，让docker运行的容器实现”对话”的能力</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">i</span> <span class="o">-</span><span class="n">t</span> <span class="n">centos</span><span class="p">:</span><span class="mf">6.8</span> <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">bash</span>
</pre></div>
</div>
<dl class="docutils">
<dt>各个参数解析：</dt>
<dd><ul class="first last simple">
<li>-t:在新容器内指定一个伪终端或终端。</li>
<li>-i:允许你对容器内的标准输入 (STDIN) 进行交互。</li>
</ul>
</dd>
</dl>
<p>这样就想一个新系统一样了</p>
<p><strong>可以通过运行exit命令或者使用CTRL+D来退出容器。</strong></p>
</div>
<div class="section" id="id3">
<h3>启动容器（后台模式）<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h3>
<p>使用以下命令创建一个以进程方式运行的容器:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="n">ubuntu</span><span class="p">:</span><span class="mf">15.10</span> <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">sh</span> <span class="o">-</span><span class="n">c</span> <span class="s2">&quot;while true; do echo hello world; sleep 1; done&quot;</span>
<span class="mi">2</span><span class="n">b1b7a428627c51ab8810d541d759f072b4fc75487eed05812646b8534a2fe63</span>
</pre></div>
</div>
<p>在输出中，我们没有看到期望的”hello world”，而是一串长字符</p>
<p>这个长字符串叫做容器ID，对每个容器来说都是唯一的，我们可以通过容器ID来查看对应的容器发生了什么。</p>
<p>首先，我们需要确认容器有在运行，可以通过
<strong>docker ps</strong>
来查看:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">ps</span>
</pre></div>
</div>
<p>CONTAINER ID:容器ID</p>
<p>NAMES:自动分配的容器名称</p>
<p>在容器内使用docker logs命令，查看容器内的标准输出:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">logs</span> <span class="mi">2</span><span class="n">b1b7a428627</span>

<span class="n">docker</span> <span class="n">logs</span> <span class="n">amazing_cori</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h3>停止容器<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h3>
<p>我们使用 docker stop 命令来停止容器:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">stop</span>  <span class="n">CONTAINER</span> <span class="n">ID</span>

<span class="n">docker</span> <span class="n">stop</span> <span class="n">NAME</span>

<span class="n">docker</span> <span class="n">ps</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id5">
<h2>Docker 客户端<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h2>
<p>docker 客户端非常简单 ,我们可以直接输入 docker 命令来查看到 Docker 客户端的所有命令选项:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span>
</pre></div>
</div>
<p>可以通过命令 docker command –help 更深入的了解指定的 Docker 命令使用方法。</p>
<p>例如我们要查看 docker stats 指令的具体使用方法:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">stats</span> <span class="o">--</span><span class="n">help</span>
</pre></div>
</div>
<div class="section" id="web">
<h3>运行一个web应用<a class="headerlink" href="#web" title="永久链接至标题">¶</a></h3>
<p>前面我们运行的容器并没有一些什么特别的用处。</p>
<p>接下来让我们尝试使用 docker 构建一个 web 应用程序。</p>
<p>我们将在docker容器中运行一个 Python Flask 应用来运行一个web应用:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">-</span><span class="n">P</span> <span class="n">training</span><span class="o">/</span><span class="n">webapp</span> <span class="n">python</span> <span class="n">app</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<dl class="docutils">
<dt>参数说明:</dt>
<dd><ul class="first last simple">
<li>-d:让容器在后台运行。</li>
<li>-P:将容器内部使用的网络端口映射到我们使用的主机上。</li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="id6">
<h3>查看 WEB 应用容器<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h3>
<p>使用 docker ps 来查看我们正在运行的容器:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">ps</span>
</pre></div>
</div>
<p>Docker 开放了 5000 端口（默认 Python Flask 端口）映射到主机端口 32769 上。</p>
<p>这里mac 有个小插曲  ，需要在virtualbox上设置端口转发</p>
<img alt="../../_images/1537937903837.jpg" src="../../_images/1537937903837.jpg" />
<img alt="../../_images/1537938271293.jpg" src="../../_images/1537938271293.jpg" />
<p>我们也可以指定 -p 标识来绑定指定端口:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">-</span><span class="n">p</span> <span class="mi">5000</span><span class="p">:</span><span class="mi">5000</span> <span class="n">training</span><span class="o">/</span><span class="n">webapp</span> <span class="n">python</span> <span class="n">app</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
</div>
<div class="section" id="id7">
<h3>网络端口的快捷方式<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h3>
<p>通过docker ps 命令可以查看到容器的端口映射，docker还提供了另一个快捷方式：docker port,使用 docker port 可以查看指定 （ID或者名字）容器的某个确定端口映射到宿主机的端口号。</p>
<p>上面我们创建的web应用容器ID为:7a38a1ad55c6 名字为：determined_swanson</p>
<p>我可以使用docker port 7a38a1ad55c6 或docker port determined_swanson来查看容器端口的映射情况:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">port</span> <span class="mi">7</span><span class="n">a38a1ad55c6</span>
<span class="n">docker</span> <span class="n">port</span> <span class="n">determined_swanson</span>
</pre></div>
</div>
</div>
<div class="section" id="id8">
<h3>查看WEB应用程序日志<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h3>
<p>docker logs [ID或者名字] 可以查看容器内部的标准输出:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">logs</span> <span class="mi">7</span><span class="n">a38a1ad55c6</span>
<span class="n">docker</span> <span class="n">logs</span> <span class="n">determined_swanson</span>
</pre></div>
</div>
<p>-f:让 dokcer logs 像使用 tail -f 一样来输出容器内部的标准输出。</p>
<p>从上面，我们可以看到应用程序使用的是 5000 端口并且能够查看到应用程序的访问日志。</p>
</div>
<div class="section" id="id9">
<h3>查看WEB应用程序容器的进程<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h3>
<p>我们还可以使用 docker top 来查看容器内部运行的进程:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">top</span> <span class="n">determined_swanson</span>
</pre></div>
</div>
</div>
<div class="section" id="id10">
<h3>检查WEB应用程序<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h3>
<p>使用 docker inspect 来查看Docker的底层信息。它会返回一个 JSON 文件记录着 Docker 容器的配置和状态信息:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">inspect</span> <span class="n">determined_swanson</span>
</pre></div>
</div>
</div>
<div class="section" id="id11">
<h3>停止WEB应用容器<a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">stop</span> <span class="n">determined_swanson</span>
</pre></div>
</div>
</div>
<div class="section" id="id12">
<h3>重启WEB应用容器<a class="headerlink" href="#id12" title="永久链接至标题">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">start</span> <span class="n">determined_swanson</span>
</pre></div>
</div>
<p>docker ps -l 来查看正在运行的容器</p>
</div>
<div class="section" id="id13">
<h3>移除WEB应用容器<a class="headerlink" href="#id13" title="永久链接至标题">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">rm</span> <span class="n">determined_swanson</span>
</pre></div>
</div>
<p>删除容器时，容器必须是停止状态，否则会报如下错误</p>
</div>
</div>
<div class="section" id="id14">
<h2>Docker 镜像使用<a class="headerlink" href="#id14" title="永久链接至标题">¶</a></h2>
<div class="section" id="id15">
<h3>Docker 镜像使用<a class="headerlink" href="#id15" title="永久链接至标题">¶</a></h3>
<p>当运行容器时，使用的镜像如果在本地中不存在，docker 就会自动从 docker 镜像仓库中下载，默认是从 Docker Hub 公共镜像源下载。</p>
<blockquote>
<div><ul class="simple">
<li>1、管理和使用本地 Docker 主机镜像</li>
<li>2、创建镜像</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="id16">
<h3>列出镜像列表<a class="headerlink" href="#id16" title="永久链接至标题">¶</a></h3>
<p>我们可以使用 docker images 来列出本地主机上的镜像:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">images</span>
</pre></div>
</div>
<dl class="docutils">
<dt>各个选项说明:</dt>
<dd><ul class="first last simple">
<li>REPOSTITORY：表示镜像的仓库源</li>
<li>TAG：镜像的标签</li>
<li>IMAGE ID：镜像ID</li>
<li>CREATED：镜像创建时间</li>
<li>SIZE：镜像大小</li>
</ul>
</dd>
</dl>
<p>同一仓库源可以有多个 TAG，代表这个仓库源的不同个版本，如ubuntu仓库源里，有15.10、14.04等多个不同的版本，我们使用 REPOSTITORY:TAG 来定义不同的镜像。</p>
<p>所以，我们如果要使用版本为15.10的ubuntu系统镜像来运行容器时，命令如下:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">t</span> <span class="o">-</span><span class="n">i</span> <span class="n">ubuntu</span><span class="p">:</span><span class="mf">15.10</span> <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">bash</span>
</pre></div>
</div>
<p>如果要使用版本为14.04的ubuntu系统镜像来运行容器时，命令如下:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">t</span> <span class="o">-</span><span class="n">i</span> <span class="n">ubuntu</span><span class="p">:</span><span class="mf">14.04</span> <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">bash</span>
</pre></div>
</div>
</div>
<div class="section" id="id17">
<h3>获取一个新的镜像<a class="headerlink" href="#id17" title="永久链接至标题">¶</a></h3>
<p>当我们在本地主机上使用一个不存在的镜像时 Docker 就会自动下载这个镜像。如果我们想预先下载这个镜像，我们可以使用 docker pull 命令来下载它:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">pull</span> <span class="n">ubuntu</span><span class="p">:</span><span class="mf">13.10</span>
</pre></div>
</div>
</div>
<div class="section" id="id18">
<h3>查找镜像<a class="headerlink" href="#id18" title="永久链接至标题">¶</a></h3>
<p>我们可以从 Docker Hub 网站来搜索镜像，Docker Hub 网址为：<a class="reference external" href="https://hub.docker.com/">https://hub.docker.com/</a></p>
<p>我们也可以使用 docker search 命令来搜索镜像。比如我们需要一个httpd的镜像来作为我们的web服务。我们可以通过 docker search 命令搜索 httpd 来寻找适合我们的镜像。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>   <span class="n">docker</span> <span class="n">search</span> <span class="n">httpd</span>


<span class="o">-</span> <span class="n">NAME</span><span class="p">:</span><span class="n">镜像仓库源的名称</span>
<span class="o">-</span> <span class="n">DESCRIPTION</span><span class="p">:</span><span class="n">镜像的描述</span>
<span class="o">-</span> <span class="n">OFFICIAL</span><span class="p">:</span><span class="n">是否docker官方发布</span>
</pre></div>
</div>
</div>
<div class="section" id="id19">
<h3>拖取镜像<a class="headerlink" href="#id19" title="永久链接至标题">¶</a></h3>
<p>我们决定使用上图中的httpd 官方版本的镜像，使用命令 docker pull 来下载镜像:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">pull</span> <span class="n">httpd</span>
</pre></div>
</div>
<p>下载完成后，我们就可以使用这个镜像了:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="n">httpd</span>
</pre></div>
</div>
</div>
<div class="section" id="id20">
<h3>创建镜像<a class="headerlink" href="#id20" title="永久链接至标题">¶</a></h3>
<dl class="docutils">
<dt>当我们从docker镜像仓库中下载的镜像不能满足我们的需求时，我们可以通过以下两种方式对镜像进行更改。</dt>
<dd><ul class="first last simple">
<li>1.从已经创建的容器中更新镜像，并且提交这个镜像</li>
<li>2.使用 Dockerfile 指令来创建一个新的镜像</li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="id21">
<h3>更新镜像<a class="headerlink" href="#id21" title="永久链接至标题">¶</a></h3>
<p>更新镜像之前，我们需要使用镜像来创建一个容器:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">t</span> <span class="o">-</span><span class="n">i</span> <span class="n">ubuntu</span><span class="p">:</span><span class="mf">15.10</span> <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">bash</span>
</pre></div>
</div>
<p>在运行的容器内使用 apt-get update 命令进行更新。</p>
<p>在完成操作之后，输入 exit命令来退出这个容器。</p>
<p>此时ID为e218edb10161的容器，是按我们的需求更改的容器。我们可以通过命令 docker commit来提交容器副本。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">commit</span> <span class="o">-</span><span class="n">m</span><span class="o">=</span><span class="s2">&quot;has update&quot;</span> <span class="o">-</span><span class="n">a</span><span class="o">=</span><span class="s2">&quot;youj&quot;</span> <span class="n">e218edb10161</span>
<span class="n">w3cschool</span><span class="o">/</span><span class="n">ubuntu</span><span class="p">:</span><span class="n">v2</span>
<span class="n">sha256</span><span class="p">:</span><span class="mi">70</span><span class="n">bf1840fd7c0d2d8ef0a42a817eb29f854c1af8f7c59fc03ac7bdee9545aff8</span>
</pre></div>
</div>
<dl class="docutils">
<dt>各个参数说明：</dt>
<dd><ul class="first last simple">
<li>-m:提交的描述信息</li>
<li>-a:指定镜像作者</li>
<li>e218edb10161：容器ID</li>
<li>w3cschool/ubuntu:v2:指定要创建的目标镜像名</li>
</ul>
</dd>
</dl>
<p>我们可以使用 docker images 命令来查看我们的新镜像 w3cschool/ubuntu:v2：</p>
</div>
<div class="section" id="id22">
<h3>构建镜像<a class="headerlink" href="#id22" title="永久链接至标题">¶</a></h3>
<p>我们使用命令 docker build ， 从零开始来创建一个新的镜像。为此，我们需要创建一个 Dockerfile 文件，其中包含一组指令来告诉 Docker 如何构建我们的镜像。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="n">Dockerfile</span>
<span class="n">FROM</span>    <span class="n">centos</span><span class="p">:</span><span class="mf">6.7</span>
<span class="n">MAINTAINER</span>      <span class="n">Fisher</span> <span class="s2">&quot;fisher@sudops.com&quot;</span>

<span class="n">RUN</span>     <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">echo</span> <span class="s1">&#39;root:123456&#39;</span> <span class="o">|</span><span class="n">chpasswd</span>
<span class="n">RUN</span>     <span class="n">useradd</span> <span class="n">youj</span>
<span class="n">RUN</span>     <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">echo</span> <span class="s1">&#39;youj:123456&#39;</span> <span class="o">|</span><span class="n">chpasswd</span>
<span class="n">RUN</span>     <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s2">&quot;LANG=</span><span class="se">\&quot;</span><span class="s2">en_US.UTF-8</span><span class="se">\&quot;</span><span class="s2">&quot;</span> <span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">default</span><span class="o">/</span><span class="n">local</span>
<span class="n">EXPOSE</span>  <span class="mi">22</span>
<span class="n">EXPOSE</span>  <span class="mi">80</span>
<span class="n">CMD</span>     <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">sshd</span> <span class="o">-</span><span class="n">D</span>
</pre></div>
</div>
<p>每一个指令都会在镜像上创建一个新的层，每一个指令的前缀都必须是大写的。</p>
<p>第一条FROM，指定使用哪个镜像源</p>
<p>RUN 指令告诉docker 在镜像内执行命令，安装了什么。。。</p>
<p>然后，我们使用 Dockerfile 文件，通过 docker build 命令来构建一个镜像。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>w3cschool@w3cschool:~$ docker build -t youj/centos:6.7 .
Sending build context to Docker daemon 17.92 kB
Step 1 : FROM centos:6.7
 ---&amp;gt; d95b5ca17cc3
Step 2 : MAINTAINER Fisher &quot;fisher@sudops.com&quot;
 ---&amp;gt; Using cache
 ---&amp;gt; 0c92299c6f03
Step 3 : RUN /bin/echo &#39;root:123456&#39; |chpasswd
 ---&amp;gt; Using cache
 ---&amp;gt; 0397ce2fbd0a
Step 4 : RUN useradd youj
......
</pre></div>
</div>
<dl class="docutils">
<dt>参数说明：</dt>
<dd><ul class="first last simple">
<li>-t ：指定要创建的目标镜像名</li>
<li>. ：Dockerfile 文件所在目录，可以指定Dockerfile 的绝对路径</li>
</ul>
</dd>
</dl>
<p>使用docker images 查看创建的镜像已经在列表中存在,镜像ID为860c279d2fec</p>
<p>我们可以使用新的镜像来创建容器</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">t</span> <span class="o">-</span><span class="n">i</span> <span class="n">youj</span><span class="o">/</span><span class="n">centos</span><span class="p">:</span><span class="mf">6.7</span>  <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">bash</span>
</pre></div>
</div>
</div>
<div class="section" id="id23">
<h3>设置镜像标签<a class="headerlink" href="#id23" title="永久链接至标题">¶</a></h3>
<p>我们可以使用 docker tag 命令，为镜像添加一个新的标签:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">tag</span> <span class="mi">860</span><span class="n">c279d2fec</span> <span class="n">youj</span><span class="o">/</span><span class="n">centos</span><span class="p">:</span><span class="n">dev</span>
</pre></div>
</div>
<p>docker tag 镜像ID，这里是 860c279d2fec ,用户名称、镜像源名(repository name)和新的标签名(tag)。</p>
<p>使用 docker images 命令可以看到，ID为860c279d2fec的镜像多一个标签。</p>
</div>
</div>
<div class="section" id="id24">
<h2>Docker 容器连接<a class="headerlink" href="#id24" title="永久链接至标题">¶</a></h2>
<div class="section" id="id25">
<h3>Docker 容器连接<a class="headerlink" href="#id25" title="永久链接至标题">¶</a></h3>
<p>前面我们实现了通过网络端口来访问运行在docker容器内的服务。下面我们来实现通过端口连接到一个docker容器</p>
<p>网络端口映射</p>
<p>我们创建了一个 python 应用的容器。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">-</span><span class="n">P</span> <span class="n">training</span><span class="o">/</span><span class="n">webapp</span> <span class="n">python</span> <span class="n">app</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>另外，我们可以指定容器绑定的网络地址，比如绑定 127.0.0.1。</p>
<p>我们使用 -P 参数创建一个容器，使用 docker ps 来看到端口5000绑定主机端口32768。</p>
<p>我们也可以使用 -p 标识来指定容器端口绑定到主机端口。</p>
<dl class="docutils">
<dt>两种方式的区别是:</dt>
<dd><ul class="first last simple">
<li>-P :是容器内部端口随机映射到主机的高端口。</li>
<li>-p :是容器内部端口绑定到指定的主机端口。</li>
</ul>
</dd>
</dl>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">-</span><span class="n">p</span> <span class="mi">5000</span><span class="p">:</span><span class="mi">5000</span> <span class="n">training</span><span class="o">/</span><span class="n">webapp</span> <span class="n">python</span> <span class="n">app</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>上面的例子中，默认都是绑定 tcp 端口，如果要绑定 UPD 端口，可以在端口后面加上 /udp。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">-</span><span class="n">p</span> <span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">5000</span><span class="p">:</span><span class="mi">5000</span><span class="o">/</span><span class="n">udp</span> <span class="n">training</span><span class="o">/</span><span class="n">webapp</span> <span class="n">python</span> <span class="n">app</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>docker port 命令可以让我们快捷地查看端口的绑定情况:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">port</span> <span class="n">adoring_stonebraker</span> <span class="mi">5002</span>
</pre></div>
</div>
</div>
<div class="section" id="id26">
<h3>Docker容器连接<a class="headerlink" href="#id26" title="永久链接至标题">¶</a></h3>
<p>端口映射并不是唯一把 docker 连接到另一个容器的方法。</p>
<p>docker有一个连接系统允许将多个容器连接在一起，共享连接信息。</p>
<p>docker连接会创建一个父子关系，其中父容器可以看到子容器的信息。</p>
<p>容器命名</p>
<p>当我们创建一个容器的时候，docker会自动对它进行命名。另外，我们也可以使用–name标识来命名容器，例如</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">-</span><span class="n">P</span> <span class="o">--</span><span class="n">name</span> <span class="n">youj</span> <span class="n">training</span><span class="o">/</span><span class="n">webapp</span> <span class="n">python</span> <span class="n">app</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../mac/mac_use_note.html" class="btn btn-neutral float-right" title="mac使用小技巧" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="centos6_install_git.html" class="btn btn-neutral" title="centos6下安装和使用git" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, anaf.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'',
            LANGUAGE:'zh_CN',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/translations.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>